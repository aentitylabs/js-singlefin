!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define([],t):"object"==typeof exports?exports.jssinglefin=t():e.jssinglefin=t()}(this,(function(){return(()=>{"use strict";var e={46:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.Follower=void 0;const s=n(591);t.Follower=class{constructor(e){this._state=new s.NullState,this._influencers=[],this._states={},this._trendStates={},this._name=e}get name(){return this._name}addInfluencer(e){this._influencers.push(e)}addState(e,t){t.name=e,this._states[e]=t}subscribe(e){this.addInfluencer(e),e.subscribe(this)}follow(e){this._influencers.forEach((t=>{t.follow(e,this._name)}))}on(e,t){this._trendStates[e]=this._states[t]}changeState(e){this._state=this._states[e]}handle(e,t){this._state.handle(this,e,t)}onTrendChange(e,t){this._trendStates[e]&&(this._state=this._trendStates[e]),this.handle(e,t)}set state(e){this._state=e}serialize(){return{name:this._name,state:this._state.name}}deserialize(e){this._name=e.name,this._state=this._states[e.state]}}},886:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.Influencer=void 0,t.Influencer=class{constructor(){this._followers={},this._trends={}}subscribe(e){this._followers[e.name]=e}init(e){for(const t in e){const n=e[t];for(let e=0;e<n.length;e++)this._followers[n[e].name]&&this._followers[n[e].name].deserialize(n[e])}}follow(e,t){this._trends[e]||(this._trends[e]=[]),this._trends[e].push(this._followers[t])}newTrend(e,t){const n=this._trends[e];if(n)for(let s=0;s<n.length;s++)n[s].onTrendChange(e,t)}serialize(){const e={followers:{}};for(const t in this._followers){const n=this._followers[t];e.followers[t]=n.serialize()}return e}}},591:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.NullState=void 0;const s=n(445);class r extends s.State{handle(e,t,n){}}t.NullState=r},445:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.State=void 0,t.State=class{constructor(){this._name=""}set name(e){this._name=e}get name(){return this._name}}},328:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.Singlefin=void 0;const s=n(886),r=n(138),i=n(138),o=n(191);class l extends s.Influencer{constructor(){super(),this._entityStore=new r.EntityStore,this._currentTrend=i.EntityFactory.newEntity(this._entityStore,{entity:"Singlefin",ref:!1,properties:{trend:{value:""},trends:{value:{}}}}),this._entityStore.addSource("Singlefin",new o.SinglefinSource)}loadModel(e){return new Promise(((t,n)=>{e.load((e=>{this._model=i.EntityFactory.newEntity(this._entityStore,e),t()}))}))}setModel(e){this._model=i.EntityFactory.newEntity(this._entityStore,e)}get model(){return this._model}addSource(e,t){this._entityStore.addSource(e,t)}inform(e){const t=this._trends[e];this._currentTrend.trend=e,this._currentTrend.trends[e]=this.serializeFollowers(t),this._entityStore.sync(),this.newTrend(e,this._model),this._entityStore.sync()}informTo(e,t){const n=this._trends[t];return this._currentTrend.trend=t,this._currentTrend.trends[t]=this.serializeFollowers(n),this._entityStore.syncTo(e).then((()=>(this.init(this._currentTrend.trends),this.newTrend(this._currentTrend.trend,this._model),this._entityStore.syncTo(e))))}informFrom(e,t){this._entityStore.syncFrom(e,t,(()=>{this.init(this._currentTrend.trends),this.newTrend(this._currentTrend.trend,this._model);const e=this._trends[this._currentTrend.trend];this._currentTrend.trends[this._currentTrend.trend]=this.serializeFollowers(e)}))}serializeFollowers(e){const t=[];for(let n=0;n<e.length;n++)t.push(e[n].serialize());return t}}t.Singlefin=l},191:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.SinglefinSource=void 0;const s=n(138);class r extends s.Source{load(e){return e}update(e){return e}delete(e){}}t.SinglefinSource=r},138:e=>{e.exports=require("js-entity-store")}},t={};function n(s){var r=t[s];if(void 0!==r)return r.exports;var i=t[s]={exports:{}};return e[s](i,i.exports,n),i.exports}var s={};return(()=>{var e=s;Object.defineProperty(e,"__esModule",{value:!0}),e.State=e.Follower=e.Singlefin=void 0;const t=n(328);Object.defineProperty(e,"Singlefin",{enumerable:!0,get:function(){return t.Singlefin}});const r=n(46);Object.defineProperty(e,"Follower",{enumerable:!0,get:function(){return r.Follower}});const i=n(445);Object.defineProperty(e,"State",{enumerable:!0,get:function(){return i.State}})})(),s})()}));
//# sourceMappingURL=data:application/json;charset=utf-8;base64,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RUFMQSxFQUFBd0MsYUFDVCxjQUlvQix3RUFKWCxFQUFBMEMsWUFFVCxlQUUyQyxxRUFGbEMsRUFBQTNDLFUiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly9qc3NpbmdsZWZpbi93ZWJwYWNrL3VuaXZlcnNhbE1vZHVsZURlZmluaXRpb24iLCJ3ZWJwYWNrOi8vanNzaW5nbGVmaW4vLi9ob21lL2VhZ3VkaW8vd29yay9hZW50aXR5L3dvcmtzcGFjZS9qcy1zaW5nbGVmaW4vc3JjL2luZmx1ZW5jZXIvZm9sbG93ZXIudHMiLCJ3ZWJwYWNrOi8vanNzaW5nbGVmaW4vLi9ob21lL2VhZ3VkaW8vd29yay9hZW50aXR5L3dvcmtzcGFjZS9qcy1zaW5nbGVmaW4vc3JjL2luZmx1ZW5jZXIvaW5mbHVlbmNlci50cyIsIndlYnBhY2s6Ly9qc3NpbmdsZWZpbi8uL2hvbWUvZWFndWRpby93b3JrL2FlbnRpdHkvd29ya3NwYWNlL2pzLXNpbmdsZWZpbi9zcmMvaW5mbHVlbmNlci9udWxsc3RhdGUudHMiLCJ3ZWJwYWNrOi8vanNzaW5nbGVmaW4vLi9ob21lL2VhZ3VkaW8vd29yay9hZW50aXR5L3dvcmtzcGFjZS9qcy1zaW5nbGVmaW4vc3JjL2luZmx1ZW5jZXIvc3RhdGUudHMiLCJ3ZWJwYWNrOi8vanNzaW5nbGVmaW4vLi9ob21lL2VhZ3VkaW8vd29yay9hZW50aXR5L3dvcmtzcGFjZS9qcy1zaW5nbGVmaW4vc3JjL3NpbmdsZWZpbi50cyIsIndlYnBhY2s6Ly9qc3NpbmdsZWZpbi8uL2hvbWUvZWFndWRpby93b3JrL2FlbnRpdHkvd29ya3NwYWNlL2pzLXNpbmdsZWZpbi9zcmMvc2luZ2xlZmluc291cmNlLnRzIiwid2VicGFjazovL2pzc2luZ2xlZmluL2V4dGVybmFsIGNvbW1vbmpzIFwianMtZW50aXR5LXN0b3JlXCIiLCJ3ZWJwYWNrOi8vanNzaW5nbGVmaW4vd2VicGFjay9ib290c3RyYXAiLCJ3ZWJwYWNrOi8vanNzaW5nbGVmaW4vLi9ob21lL2VhZ3VkaW8vd29yay9hZW50aXR5L3dvcmtzcGFjZS9qcy1zaW5nbGVmaW4vc3JjL21haW4udHMiXSwic291cmNlc0NvbnRlbnQiOlsiKGZ1bmN0aW9uIHdlYnBhY2tVbml2ZXJzYWxNb2R1bGVEZWZpbml0aW9uKHJvb3QsIGZhY3RvcnkpIHtcblx0aWYodHlwZW9mIGV4cG9ydHMgPT09ICdvYmplY3QnICYmIHR5cGVvZiBtb2R1bGUgPT09ICdvYmplY3QnKVxuXHRcdG1vZHVsZS5leHBvcnRzID0gZmFjdG9yeSgpO1xuXHRlbHNlIGlmKHR5cGVvZiBkZWZpbmUgPT09ICdmdW5jdGlvbicgJiYgZGVmaW5lLmFtZClcblx0XHRkZWZpbmUoW10sIGZhY3RvcnkpO1xuXHRlbHNlIGlmKHR5cGVvZiBleHBvcnRzID09PSAnb2JqZWN0Jylcblx0XHRleHBvcnRzW1wianNzaW5nbGVmaW5cIl0gPSBmYWN0b3J5KCk7XG5cdGVsc2Vcblx0XHRyb290W1wianNzaW5nbGVmaW5cIl0gPSBmYWN0b3J5KCk7XG59KSh0aGlzLCBmdW5jdGlvbigpIHtcbnJldHVybiAiLCJpbXBvcnQgeyBJbmZsdWVuY2VyIH0gZnJvbSBcIi4vaW5mbHVlbmNlclwiO1xuaW1wb3J0IHsgTnVsbFN0YXRlIH0gZnJvbSBcIi4vbnVsbHN0YXRlXCI7XG5pbXBvcnQgeyBTdGF0ZSB9IGZyb20gXCIuL3N0YXRlXCI7XG5cbmV4cG9ydCBjbGFzcyBGb2xsb3dlciB7XG4gICAgcHJpdmF0ZSBfbmFtZTogc3RyaW5nO1xuICAgIHByaXZhdGUgX3N0YXRlOiBTdGF0ZSA9IG5ldyBOdWxsU3RhdGUoKTtcbiAgICBwcml2YXRlIF9pbmZsdWVuY2VyczogSW5mbHVlbmNlcltdID0gW107XG4gICAgcHJpdmF0ZSBfc3RhdGVzOiBhbnkgPSB7fTtcbiAgICBwcml2YXRlIF90cmVuZFN0YXRlczogYW55ID0ge307XG5cblxuICAgIHB1YmxpYyBjb25zdHJ1Y3RvcihuYW1lOiBzdHJpbmcpIHtcbiAgICAgICAgdGhpcy5fbmFtZSA9IG5hbWU7XG4gICAgfVxuXG4gICAgcHVibGljIGdldCBuYW1lKCkge1xuICAgICAgICByZXR1cm4gdGhpcy5fbmFtZTtcbiAgICB9XG4gICAgXG4gICAgcHVibGljIGFkZEluZmx1ZW5jZXIoaW5mbHVlbmNlcjogSW5mbHVlbmNlcikge1xuICAgICAgICB0aGlzLl9pbmZsdWVuY2Vycy5wdXNoKGluZmx1ZW5jZXIpO1xuICAgIH1cblxuICAgIHB1YmxpYyBhZGRTdGF0ZShzdGF0ZU5hbWU6IHN0cmluZywgc3RhdGU6IFN0YXRlKSB7XG4gICAgICAgIHN0YXRlLm5hbWUgPSBzdGF0ZU5hbWU7XG5cbiAgICAgICAgdGhpcy5fc3RhdGVzW3N0YXRlTmFtZV0gPSBzdGF0ZTtcbiAgICB9XG5cbiAgICBwdWJsaWMgc3Vic2NyaWJlKGluZmx1ZW5jZXI6IEluZmx1ZW5jZXIpIHtcbiAgICAgICAgdGhpcy5hZGRJbmZsdWVuY2VyKGluZmx1ZW5jZXIpO1xuXG4gICAgICAgIGluZmx1ZW5jZXIuc3Vic2NyaWJlKHRoaXMpO1xuICAgIH1cblxuICAgIHB1YmxpYyBmb2xsb3codHJlbmQ6IHN0cmluZykge1xuICAgICAgICB0aGlzLl9pbmZsdWVuY2Vycy5mb3JFYWNoKChpbmZsdWVuY2VyOiBJbmZsdWVuY2VyKSA9PiB7XG4gICAgICAgICAgICBpbmZsdWVuY2VyLmZvbGxvdyh0cmVuZCwgdGhpcy5fbmFtZSk7XG4gICAgICAgIH0pO1xuICAgIH1cblxuICAgIHB1YmxpYyBvbih0cmVuZDogc3RyaW5nLCBzdGF0ZTogc3RyaW5nKSB7XG4gICAgICAgIHRoaXMuX3RyZW5kU3RhdGVzW3RyZW5kXSA9IHRoaXMuX3N0YXRlc1tzdGF0ZV07XG4gICAgfVxuXG4gICAgcHVibGljIGNoYW5nZVN0YXRlKHN0YXRlOiBzdHJpbmcpIHtcbiAgICAgICAgdGhpcy5fc3RhdGUgPSB0aGlzLl9zdGF0ZXNbc3RhdGVdO1xuICAgIH1cblxuICAgIHB1YmxpYyBoYW5kbGUodHJlbmQ6IHN0cmluZywgbW9kZWw6IGFueSk6IHZvaWQge1xuICAgICAgICB0aGlzLl9zdGF0ZS5oYW5kbGUodGhpcywgdHJlbmQsIG1vZGVsKTtcbiAgICB9XG5cbiAgICBwdWJsaWMgb25UcmVuZENoYW5nZSh0cmVuZDogc3RyaW5nLCBtb2RlbDogYW55KTogdm9pZCB7XG4gICAgICAgIGlmKHRoaXMuX3RyZW5kU3RhdGVzW3RyZW5kXSkge1xuICAgICAgICAgICAgdGhpcy5fc3RhdGUgPSB0aGlzLl90cmVuZFN0YXRlc1t0cmVuZF07XG4gICAgICAgIH1cbiAgICAgICAgXG4gICAgICAgIHRoaXMuaGFuZGxlKHRyZW5kLCBtb2RlbCk7XG4gICAgfVxuXG4gICAgcHVibGljIHNldCBzdGF0ZShzdGF0ZTogU3RhdGUpIHtcbiAgICAgICAgdGhpcy5fc3RhdGUgPSBzdGF0ZTtcbiAgICB9XG5cbiAgICBwdWJsaWMgc2VyaWFsaXplKCk6IGFueSB7XG4gICAgICAgIHJldHVybiB7XG4gICAgICAgICAgICBuYW1lOiB0aGlzLl9uYW1lLFxuICAgICAgICAgICAgc3RhdGU6IHRoaXMuX3N0YXRlLm5hbWVcbiAgICAgICAgfVxuICAgIH1cblxuICAgIHB1YmxpYyBkZXNlcmlhbGl6ZShmb2xsb3dlcjogYW55KSB7XG4gICAgICAgIHRoaXMuX25hbWUgPSBmb2xsb3dlci5uYW1lO1xuICAgICAgICB0aGlzLl9zdGF0ZSA9IHRoaXMuX3N0YXRlc1tmb2xsb3dlci5zdGF0ZV07XG4gICAgfVxufSIsImltcG9ydCB7IEZvbGxvd2VyIH0gZnJvbSBcIi4vZm9sbG93ZXJcIjtcblxuZXhwb3J0IGNsYXNzIEluZmx1ZW5jZXIge1xuICAgIHByb3RlY3RlZCBfZm9sbG93ZXJzOiBhbnkgPSB7fTtcbiAgICBwcm90ZWN0ZWQgX3RyZW5kczogYW55ID0ge307XG5cblxuICAgIHB1YmxpYyBzdWJzY3JpYmUoZm9sbG93ZXI6IEZvbGxvd2VyKXtcbiAgICAgICAgdGhpcy5fZm9sbG93ZXJzW2ZvbGxvd2VyLm5hbWVdID0gZm9sbG93ZXI7XG4gICAgfVxuXG4gICAgcHVibGljIGluaXQodHJlbmRzOiBhbnkpIHtcbiAgICAgICAgZm9yKGNvbnN0IGtleSBpbiB0cmVuZHMpIHtcbiAgICAgICAgICAgIGNvbnN0IGZvbGxvd2VycyA9IHRyZW5kc1trZXldO1xuXG4gICAgICAgICAgICBmb3IobGV0IGk9MDsgaTxmb2xsb3dlcnMubGVuZ3RoOyBpKyspIHtcbiAgICAgICAgICAgICAgICBpZih0aGlzLl9mb2xsb3dlcnNbZm9sbG93ZXJzW2ldLm5hbWVdKSB7XG4gICAgICAgICAgICAgICAgICAgIGNvbnN0IGZvbGxvd2VyID0gdGhpcy5fZm9sbG93ZXJzW2ZvbGxvd2Vyc1tpXS5uYW1lXTtcblxuICAgICAgICAgICAgICAgICAgICBmb2xsb3dlci5kZXNlcmlhbGl6ZShmb2xsb3dlcnNbaV0pO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgIH1cblxuICAgIHB1YmxpYyBmb2xsb3codHJlbmQ6IHN0cmluZywgZm9sbG93ZXI6IHN0cmluZykge1xuICAgICAgICBpZighdGhpcy5fdHJlbmRzW3RyZW5kXSkge1xuICAgICAgICAgICAgdGhpcy5fdHJlbmRzW3RyZW5kXSA9IFtdO1xuICAgICAgICB9XG4gICAgICAgIFxuICAgICAgICB0aGlzLl90cmVuZHNbdHJlbmRdLnB1c2godGhpcy5fZm9sbG93ZXJzW2ZvbGxvd2VyXSk7XG4gICAgfVxuXG4gICAgcHVibGljIG5ld1RyZW5kKHRyZW5kOiBzdHJpbmcsIG1vZGVsOiBhbnkpIHtcbiAgICAgICAgY29uc3QgZm9sbG93ZXJzID0gdGhpcy5fdHJlbmRzW3RyZW5kXTtcblxuICAgICAgICBpZighZm9sbG93ZXJzKSB7XG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgIH1cblxuICAgICAgICBmb3IobGV0IGk9MDsgaTxmb2xsb3dlcnMubGVuZ3RoOyBpKyspIHtcbiAgICAgICAgICAgIGZvbGxvd2Vyc1tpXS5vblRyZW5kQ2hhbmdlKHRyZW5kLCBtb2RlbCk7XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICBwdWJsaWMgc2VyaWFsaXplKCk6IGFueSB7XG4gICAgICAgIGNvbnN0IGluZmx1ZW5jZXI6IGFueSA9IHtcbiAgICAgICAgICAgIGZvbGxvd2Vyczoge31cbiAgICAgICAgfTtcblxuICAgICAgICBmb3IoY29uc3Qga2V5IGluIHRoaXMuX2ZvbGxvd2Vycykge1xuICAgICAgICAgICAgY29uc3QgZm9sbG93ZXIgPSB0aGlzLl9mb2xsb3dlcnNba2V5XTtcbiAgICAgICAgICAgIFxuICAgICAgICAgICAgaW5mbHVlbmNlci5mb2xsb3dlcnNba2V5XSA9IGZvbGxvd2VyLnNlcmlhbGl6ZSgpO1xuICAgICAgICB9XG5cbiAgICAgICAgcmV0dXJuIGluZmx1ZW5jZXI7XG4gICAgfVxufSIsImltcG9ydCB7IEZvbGxvd2VyIH0gZnJvbSBcIi4vZm9sbG93ZXJcIjtcbmltcG9ydCB7IFN0YXRlIH0gZnJvbSBcIi4vc3RhdGVcIjtcblxuZXhwb3J0IGNsYXNzIE51bGxTdGF0ZSBleHRlbmRzIFN0YXRlIHtcbiAgICBwdWJsaWMgaGFuZGxlKGZvbGxvd2VyOiBGb2xsb3dlciwgdHJlbmQ6IHN0cmluZywgbW9kZWw6IGFueSk6IHZvaWQge1xuICAgICAgICBcbiAgICB9XG59IiwiaW1wb3J0IHsgRm9sbG93ZXIgfSBmcm9tIFwiLi9mb2xsb3dlclwiO1xuXG5leHBvcnQgYWJzdHJhY3QgY2xhc3MgU3RhdGUge1xuICAgIHByaXZhdGUgX25hbWU6IHN0cmluZyA9IFwiXCI7XG5cblxuICAgIHB1YmxpYyBzZXQgbmFtZShuYW1lOiBzdHJpbmcpIHtcbiAgICAgICAgdGhpcy5fbmFtZSA9IG5hbWU7XG4gICAgfVxuXG4gICAgcHVibGljIGdldCBuYW1lKCkge1xuICAgICAgICByZXR1cm4gdGhpcy5fbmFtZTtcbiAgICB9XG5cbiAgICBwdWJsaWMgYWJzdHJhY3QgaGFuZGxlKGZvbGxvd2VyOiBGb2xsb3dlciwgdHJlbmQ6IHN0cmluZywgbW9kZWw6IGFueSk6IHZvaWQ7XG59IiwiaW1wb3J0IHsgSW5mbHVlbmNlciB9IGZyb20gXCIuL2luZmx1ZW5jZXIvaW5mbHVlbmNlclwiO1xuaW1wb3J0IHsgRW50aXR5U3RvcmUgfSBmcm9tIFwianMtZW50aXR5LXN0b3JlXCJcbmltcG9ydCB7IEVudGl0eUZhY3RvcnkgfSBmcm9tIFwianMtZW50aXR5LXN0b3JlXCI7XG5pbXBvcnQgeyBTb3VyY2UgfSBmcm9tIFwianMtZW50aXR5LXN0b3JlXCI7XG5pbXBvcnQgeyBCcmlkZ2UgfSBmcm9tIFwianMtZW50aXR5LXN0b3JlXCI7XG5pbXBvcnQgeyBTaW5nbGVmaW5Tb3VyY2UgfSBmcm9tIFwiLi9zaW5nbGVmaW5zb3VyY2VcIjtcbmltcG9ydCB7IE1vZGVsTG9hZGVyIH0gZnJvbSBcIi4vbW9kZWxsb2FkZXJcIjtcblxuXG5leHBvcnQgY2xhc3MgU2luZ2xlZmluIGV4dGVuZHMgSW5mbHVlbmNlciB7XG4gICAgcHJpdmF0ZSBfZW50aXR5U3RvcmU6IEVudGl0eVN0b3JlID0gbmV3IEVudGl0eVN0b3JlKCk7XG4gICAgcHJpdmF0ZSBfbW9kZWw6IGFueTtcbiAgICBwcml2YXRlIF9jdXJyZW50VHJlbmQ6IGFueTtcblxuICAgIHB1YmxpYyBjb25zdHJ1Y3RvcigpIHtcbiAgICAgICAgc3VwZXIoKTtcblxuICAgICAgICB0aGlzLl9jdXJyZW50VHJlbmQgPSBFbnRpdHlGYWN0b3J5Lm5ld0VudGl0eSh0aGlzLl9lbnRpdHlTdG9yZSwge1xuICAgICAgICAgICAgXCJlbnRpdHlcIjogXCJTaW5nbGVmaW5cIixcbiAgICAgICAgICAgIFwicmVmXCI6IGZhbHNlLFxuICAgICAgICAgICAgXCJwcm9wZXJ0aWVzXCI6IHtcbiAgICAgICAgICAgICAgICBcInRyZW5kXCI6IHtcbiAgICAgICAgICAgICAgICAgICAgXCJ2YWx1ZVwiOiBcIlwiXG4gICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICBcInRyZW5kc1wiOiB7XG4gICAgICAgICAgICAgICAgICAgIFwidmFsdWVcIjoge31cbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgIH0pO1xuXG4gICAgICAgIHRoaXMuX2VudGl0eVN0b3JlLmFkZFNvdXJjZShcIlNpbmdsZWZpblwiLCBuZXcgU2luZ2xlZmluU291cmNlKCkpO1xuICAgIH1cblxuICAgIHB1YmxpYyBsb2FkTW9kZWwobW9kZWxMb2FkZXI6IE1vZGVsTG9hZGVyKSB7XG4gICAgICAgIHJldHVybiBuZXcgUHJvbWlzZTx2b2lkPigocmVzb2x2ZSwgcmVqZWN0KSA9PiB7XG4gICAgICAgICAgICBtb2RlbExvYWRlci5sb2FkKChtb2RlbDogYW55KSA9PiB7XG4gICAgICAgICAgICAgICAgdGhpcy5fbW9kZWwgPSBFbnRpdHlGYWN0b3J5Lm5ld0VudGl0eSh0aGlzLl9lbnRpdHlTdG9yZSwgbW9kZWwpO1xuXG4gICAgICAgICAgICAgICAgcmVzb2x2ZSgpO1xuICAgICAgICAgICAgfSk7XG4gICAgICAgIH0pO1xuICAgIH1cblxuICAgIHB1YmxpYyBzZXRNb2RlbChtb2RlbDogYW55KSB7XG4gICAgICAgIHRoaXMuX21vZGVsID0gRW50aXR5RmFjdG9yeS5uZXdFbnRpdHkodGhpcy5fZW50aXR5U3RvcmUsIG1vZGVsKTtcbiAgICB9XG5cbiAgICBwdWJsaWMgZ2V0IG1vZGVsKCk6IGFueSB7XG4gICAgICAgIHJldHVybiB0aGlzLl9tb2RlbDtcbiAgICB9XG5cbiAgICBwdWJsaWMgYWRkU291cmNlKGVudGl0eU5hbWU6IHN0cmluZywgc291cmNlOiBTb3VyY2UpIHtcbiAgICAgICAgdGhpcy5fZW50aXR5U3RvcmUuYWRkU291cmNlKGVudGl0eU5hbWUsIHNvdXJjZSk7XG4gICAgfVxuXG4gICAgcHVibGljIGluZm9ybSh0cmVuZDogc3RyaW5nKSB7XG4gICAgICAgIGNvbnN0IGZvbGxvd2VycyA9IHRoaXMuX3RyZW5kc1t0cmVuZF07XG5cbiAgICAgICAgdGhpcy5fY3VycmVudFRyZW5kLnRyZW5kID0gdHJlbmQ7XG4gICAgICAgIHRoaXMuX2N1cnJlbnRUcmVuZC50cmVuZHNbdHJlbmRdID0gdGhpcy5zZXJpYWxpemVGb2xsb3dlcnMoZm9sbG93ZXJzKTtcblxuICAgICAgICB0aGlzLl9lbnRpdHlTdG9yZS5zeW5jKCk7XG5cbiAgICAgICAgdGhpcy5uZXdUcmVuZCh0cmVuZCwgdGhpcy5fbW9kZWwpO1xuXG4gICAgICAgIHRoaXMuX2VudGl0eVN0b3JlLnN5bmMoKTtcbiAgICB9XG5cbiAgICBwdWJsaWMgaW5mb3JtVG8oYnJpZGdlOiBCcmlkZ2UsIHRyZW5kOiBzdHJpbmcpIHtcbiAgICAgICAgY29uc3QgZm9sbG93ZXJzID0gdGhpcy5fdHJlbmRzW3RyZW5kXTtcblxuICAgICAgICB0aGlzLl9jdXJyZW50VHJlbmQudHJlbmQgPSB0cmVuZDtcbiAgICAgICAgdGhpcy5fY3VycmVudFRyZW5kLnRyZW5kc1t0cmVuZF0gPSB0aGlzLnNlcmlhbGl6ZUZvbGxvd2Vycyhmb2xsb3dlcnMpO1xuXG4gICAgICAgIHJldHVybiB0aGlzLl9lbnRpdHlTdG9yZS5zeW5jVG8oYnJpZGdlKS50aGVuKCgpID0+IHtcbiAgICAgICAgICAgIHRoaXMuaW5pdCh0aGlzLl9jdXJyZW50VHJlbmQudHJlbmRzKTtcblxuICAgICAgICAgICAgdGhpcy5uZXdUcmVuZCh0aGlzLl9jdXJyZW50VHJlbmQudHJlbmQsIHRoaXMuX21vZGVsKTtcblxuICAgICAgICAgICAgcmV0dXJuIHRoaXMuX2VudGl0eVN0b3JlLnN5bmNUbyhicmlkZ2UpO1xuICAgICAgICB9KTtcbiAgICB9XG5cbiAgICBwdWJsaWMgaW5mb3JtRnJvbShicmlkZ2U6IEJyaWRnZSwgYWN0aW9uczogYW55KSB7XG4gICAgICAgIHRoaXMuX2VudGl0eVN0b3JlLnN5bmNGcm9tKGJyaWRnZSwgYWN0aW9ucywgKCkgPT4ge1xuICAgICAgICAgICAgdGhpcy5pbml0KHRoaXMuX2N1cnJlbnRUcmVuZC50cmVuZHMpO1xuXG4gICAgICAgICAgICB0aGlzLm5ld1RyZW5kKHRoaXMuX2N1cnJlbnRUcmVuZC50cmVuZCwgdGhpcy5fbW9kZWwpO1xuXG4gICAgICAgICAgICBjb25zdCBmb2xsb3dlcnMgPSB0aGlzLl90cmVuZHNbdGhpcy5fY3VycmVudFRyZW5kLnRyZW5kXTtcblxuICAgICAgICAgICAgdGhpcy5fY3VycmVudFRyZW5kLnRyZW5kc1t0aGlzLl9jdXJyZW50VHJlbmQudHJlbmRdID0gdGhpcy5zZXJpYWxpemVGb2xsb3dlcnMoZm9sbG93ZXJzKTtcbiAgICAgICAgfSk7XG4gICAgfVxuXG4gICAgcHJpdmF0ZSBzZXJpYWxpemVGb2xsb3dlcnMoZm9sbG93ZXJzOiBhbnlbXSkge1xuICAgICAgICBjb25zdCBzZXJpYWxpemVkRm9sbG93ZXJzID0gW107XG5cbiAgICAgICAgZm9yKGxldCBpPTA7IGk8Zm9sbG93ZXJzLmxlbmd0aDsgaSsrKSB7XG4gICAgICAgICAgICBzZXJpYWxpemVkRm9sbG93ZXJzLnB1c2goZm9sbG93ZXJzW2ldLnNlcmlhbGl6ZSgpKTtcbiAgICAgICAgfVxuXG4gICAgICAgIHJldHVybiBzZXJpYWxpemVkRm9sbG93ZXJzO1xuICAgIH1cbn1cbiIsImltcG9ydCB7IFNvdXJjZSB9IGZyb20gXCJqcy1lbnRpdHktc3RvcmVcIjtcblxuZXhwb3J0IGNsYXNzIFNpbmdsZWZpblNvdXJjZSBleHRlbmRzIFNvdXJjZSB7XG4gICAgcHVibGljIGxvYWQoZW50aXR5OiBhbnkpIHtcbiAgICAgICAgcmV0dXJuIGVudGl0eTtcbiAgICB9XG4gICAgcHVibGljIHVwZGF0ZShlbnRpdHk6IGFueSkge1xuICAgICAgICByZXR1cm4gZW50aXR5O1xuICAgIH1cbiAgICBwdWJsaWMgZGVsZXRlKGVudGl0eTogYW55KTogdm9pZCB7XG4gICAgfVxuICAgIFxufSIsIm1vZHVsZS5leHBvcnRzID0gcmVxdWlyZShcImpzLWVudGl0eS1zdG9yZVwiKTsiLCIvLyBUaGUgbW9kdWxlIGNhY2hlXG52YXIgX193ZWJwYWNrX21vZHVsZV9jYWNoZV9fID0ge307XG5cbi8vIFRoZSByZXF1aXJlIGZ1bmN0aW9uXG5mdW5jdGlvbiBfX3dlYnBhY2tfcmVxdWlyZV9fKG1vZHVsZUlkKSB7XG5cdC8vIENoZWNrIGlmIG1vZHVsZSBpcyBpbiBjYWNoZVxuXHR2YXIgY2FjaGVkTW9kdWxlID0gX193ZWJwYWNrX21vZHVsZV9jYWNoZV9fW21vZHVsZUlkXTtcblx0aWYgKGNhY2hlZE1vZHVsZSAhPT0gdW5kZWZpbmVkKSB7XG5cdFx0cmV0dXJuIGNhY2hlZE1vZHVsZS5leHBvcnRzO1xuXHR9XG5cdC8vIENyZWF0ZSBhIG5ldyBtb2R1bGUgKGFuZCBwdXQgaXQgaW50byB0aGUgY2FjaGUpXG5cdHZhciBtb2R1bGUgPSBfX3dlYnBhY2tfbW9kdWxlX2NhY2hlX19bbW9kdWxlSWRdID0ge1xuXHRcdC8vIG5vIG1vZHVsZS5pZCBuZWVkZWRcblx0XHQvLyBubyBtb2R1bGUubG9hZGVkIG5lZWRlZFxuXHRcdGV4cG9ydHM6IHt9XG5cdH07XG5cblx0Ly8gRXhlY3V0ZSB0aGUgbW9kdWxlIGZ1bmN0aW9uXG5cdF9fd2VicGFja19tb2R1bGVzX19bbW9kdWxlSWRdKG1vZHVsZSwgbW9kdWxlLmV4cG9ydHMsIF9fd2VicGFja19yZXF1aXJlX18pO1xuXG5cdC8vIFJldHVybiB0aGUgZXhwb3J0cyBvZiB0aGUgbW9kdWxlXG5cdHJldHVybiBtb2R1bGUuZXhwb3J0cztcbn1cblxuIiwiaW1wb3J0IHsgU2luZ2xlZmluIH0gZnJvbSBcIi4vc2luZ2xlZmluXCI7XG5pbXBvcnQgeyBGb2xsb3dlciB9IGZyb20gXCIuL2luZmx1ZW5jZXIvZm9sbG93ZXJcIjtcbmltcG9ydCB7IE1vZGVsTG9hZGVyIH0gZnJvbSBcIi4vbW9kZWxsb2FkZXJcIjtcbmltcG9ydCB7IFN0YXRlIH0gZnJvbSBcIi4vaW5mbHVlbmNlci9zdGF0ZVwiO1xuXG5leHBvcnQgeyBTaW5nbGVmaW4sIEZvbGxvd2VyLCBNb2RlbExvYWRlciwgU3RhdGUgfSJdLCJuYW1lcyI6WyJyb290IiwiZmFjdG9yeSIsImV4cG9ydHMiLCJtb2R1bGUiLCJkZWZpbmUiLCJhbWQiLCJ0aGlzIiwibmFtZSIsIl9zdGF0ZSIsIk51bGxTdGF0ZSIsIl9pbmZsdWVuY2VycyIsIl9zdGF0ZXMiLCJfdHJlbmRTdGF0ZXMiLCJfbmFtZSIsImFkZEluZmx1ZW5jZXIiLCJpbmZsdWVuY2VyIiwicHVzaCIsImFkZFN0YXRlIiwic3RhdGVOYW1lIiwic3RhdGUiLCJzdWJzY3JpYmUiLCJmb2xsb3ciLCJ0cmVuZCIsImZvckVhY2giLCJvbiIsImNoYW5nZVN0YXRlIiwiaGFuZGxlIiwibW9kZWwiLCJvblRyZW5kQ2hhbmdlIiwic2VyaWFsaXplIiwiZGVzZXJpYWxpemUiLCJmb2xsb3dlciIsIl9mb2xsb3dlcnMiLCJfdHJlbmRzIiwiaW5pdCIsInRyZW5kcyIsImtleSIsImZvbGxvd2VycyIsImkiLCJsZW5ndGgiLCJuZXdUcmVuZCIsIlN0YXRlIiwiU2luZ2xlZmluIiwiSW5mbHVlbmNlciIsInN1cGVyIiwiX2VudGl0eVN0b3JlIiwiRW50aXR5U3RvcmUiLCJfY3VycmVudFRyZW5kIiwiRW50aXR5RmFjdG9yeSIsIm5ld0VudGl0eSIsImFkZFNvdXJjZSIsIlNpbmdsZWZpblNvdXJjZSIsImxvYWRNb2RlbCIsIm1vZGVsTG9hZGVyIiwiUHJvbWlzZSIsInJlc29sdmUiLCJyZWplY3QiLCJsb2FkIiwiX21vZGVsIiwic2V0TW9kZWwiLCJlbnRpdHlOYW1lIiwic291cmNlIiwiaW5mb3JtIiwic2VyaWFsaXplRm9sbG93ZXJzIiwic3luYyIsImluZm9ybVRvIiwiYnJpZGdlIiwic3luY1RvIiwidGhlbiIsImluZm9ybUZyb20iLCJhY3Rpb25zIiwic3luY0Zyb20iLCJzZXJpYWxpemVkRm9sbG93ZXJzIiwiU291cmNlIiwiZW50aXR5IiwidXBkYXRlIiwiZGVsZXRlIiwicmVxdWlyZSIsIl9fd2VicGFja19tb2R1bGVfY2FjaGVfXyIsIl9fd2VicGFja19yZXF1aXJlX18iLCJtb2R1bGVJZCIsImNhY2hlZE1vZHVsZSIsInVuZGVmaW5lZCIsIl9fd2VicGFja19tb2R1bGVzX18iLCJGb2xsb3dlciJdLCJzb3VyY2VSb290IjoiIn0=